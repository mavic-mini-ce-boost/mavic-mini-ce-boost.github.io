<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DJI Mavic Mini CE max power boost</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

</head>
<body>
  <div class="container">
    <h1>DJI Mavic Mini CE boost</h1>

    <h2>Disclaimer</h2>
    <p class="lead">This is an experiment solely for educational purpose.</p>
    <p>Please do not attempt it as this will void your warranty and can possibly violate local regulations on radio usage.
      <a href="https://www.dji.com/flysafe" target="_blank">Fly Safe</a>.</p>
    <p>Below there are instructions on how to undo the changes.</p>

    <h2>Overview</h2>
    <!--<p>Mavic Mini comes in several hardware versions for different markets. FCC for USA, CE for Europe and there's a version for Japan. FCC, CE and Japanese version all differ in hardware of the aircraft (AC) and the remote controller (RC).</p>-->
    <p>
      This hack allows Mavic Mini CE drone and remote controller to bypass local regulation limitations, 
      enabling all WiFi channels and maximum transmission power.
      After applying this hack use your drone as usual, as out of the box.
    </p>
    <ol>
      <li>Step 1. Make the drone "think" it is in USA or Bolivia, where both 2.4 GHz and 5.8 GHz ranges can be used;</li>
      <li>Step 2. Permanently prevent the Remote Controller from resetting the drone back to local limitations.</li>
    </ol>

    <h2>Step 1</h2>
    <p>TODO: write in details about Android phone with 
      <a href="https://play.google.com/store/apps/details?id=com.lexa.fakegps" target="_blank">
        Fake GPS Location
      </a> app setting phone location to the USA; old version of 
      <a href="https://www.apkmirror.com/apk/dji-technology-co-ltd/dji-fly/dji-fly-1-1-2-release/dji-fly-1-1-2-2-android-apk-download/" target="_blank">
        DJI Fly App (1.1.2)
      </a> from ApkMirror.</p>
      <p>. . .</p>

    <h2>Step 2</h2>
    <p>Patch the Remote Controller to permanently freeze the changes made in step 1.</p>
    <p>Will need:
      <ol>
        <li>Computer with USB port and fresh modern browser: Chrome, Opera or Edge.
          <br><s>Safari</s>, <s>FireFox</s> not supported;</li>
        <li>Your Mavic Mini remote controller;</li>
        <li>USB cable to connect the remote controller to this computer.</li>
      </ol>
    </p>
    <h5>Two actions:</h5>
    <ol>
      <li>Enable Experimental features in your browser and restart the browser;</li>
      <li>Connect the Remote Controller and click the button below.</li>
    </ol>


    <h3>Enable your browser</h3>
    <p>At this moment you need to enable Experimental Web Platform Features. Copy the right URL below and paste it in new tab Address bar:</p>
    <pre>
    chrome://flags/#enable-experimental-web-platform-features

    opera://flags/#enable-experimental-web-platform-features

    edge://flags/#enable-experimental-web-platform-features
    </pre>
    <p>Enable the Experimental Web Platform Features there. Browser will ask to restart.</p>

    <h3>Boost the Remote Controller</h3>
    <ol>
      <li>Connect your Remote Controller with USB cable to this computer.</li>
      <li>Turn the Remote ON.</li>
      <li>Click the button to select the Serial port of the Remote ("Gadget Serial v2_4") and apply the patch:
        <br>
        <button class="btn btn-success" id="btn-boost">
          Apply Patch
        </button>
      </li>
    </ol>

    <div id="alert-patch" class="alert alert-success d-none" role="alert"></div>

    <h3>Undo the patch</h3>
    <p>Return your Remote Controller to the original "stock" state.</p>
    <ol>
      <li>Connect your Remote Controller with USB cable to this computer.</li>
      <li>Turn the Remote ON.</li>
      <li>Click the button to select the Serial port of the Remote ("Gadget Serial v2_4") and undo the patch:
        <br>
        <button class="btn btn-info" id="btn-stock">
          Undo Patch
        </button>
      </li>
    </ol>
    <div id="alert-undo" class="alert alert-success d-none" role="alert"></div>


    <h2>FAQ â€“ frequently asked questions</h2>
    <dl>
      <dt>Can I update DJI Fly App?</dt>
      <dd>Yes. The old <code>1.1.2</code> version was only required once in Step 1. After applying the hack remove that old version and install a fresh DJI Fly App from Google Play. Update it as usual.</dd>
    </dl>

    <h2>Credits</h2>
    <p>Hack idea and magic byte sequences: Andrey (Telegram @skyhackru, site Skyhack.ru) and Telegram chat @mavicminirus (in Russian)</p>
    <p>In-browser JavaScript version: Sergei Sokolov (Telegram @sergiks)</p>


  </div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

<script>
  const showAlert = (id, text, is_error) => {
    const el = document.getElementById(id);
    el.innerText = text;
    el.classList.remove('d-none');
    if (is_error) {
      el.classList.remove('alert-success');
      el.classList.add('alert-danger');
    }
  }


  // Byte sequence credits: skyhack.ru  t.me/skyhackru
  const data = {
    boost: new Uint8Array([85, 14, 4, 102, 42, 27,  7,  39, 64, 6, 251, 2, 172, 53]),
    stock: new Uint8Array([85, 14, 4, 102, 42, 27, 37, 249, 64, 6, 251, 3, 156, 55]),
  };

  const patch = async (arrayBuffer, alertId, alertText) => {
    if ('serial' in navigator) {
      try {
        const port = await navigator.serial.requestPort();

        // const info = port.getInfo();
        // if (info.usbProductId && info.usbVendorId) {
        //   if (info.usbProductId == 8  &&  info.usbVendorId == 11427) {
        //     // Mavic Mini remote, for sure
        //   }
        // }

        await port.open({ baudRate: 9600, baudrate: 9600 }); // spelling varies

        const writer = port.writable.getWriter();
        writer.write(arrayBuffer);

        showAlert(alertId, alertText);

      } catch (err) {

        console.error('There was an error opening the serial port:', err);
        showAlert(alertId, 'There was an error opening the serial port.', true);
        
      }
      
    } else {
      
      console.error('The Web serial API doesn\'t seem to be enabled in your browser.');
      showAlert(alertId, 'The Web serial API doesn\'t seem to be enabled in your browser.', true);

    }
  }

  const addListener = (id, bytes, alertId, alertText) => document.getElementById(id).addEventListener('click', () => patch(bytes, alertId, alertText));
  addListener('btn-boost', data.boost, 'alert-patch', 'Congratulations! Your Mavic Mini is patched.');
  addListener('btn-stock', data.stock, 'alert-undo', 'Congratulations! Your Mavic Mini is in original state.');

</script>
</body>
</html>